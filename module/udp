#!/bin/bash

# Chargement du module graphique
source /etc/UDPCustom/module

# Configuration
ADMIN_CONTACT="t.me/joeldata237"
# URL de ton Bot GÃ©nÃ©rateur de Key (Local sur le VPS)
VERIFY_URL="http://127.0.0.1:5000/verify"
LICENSE_FILE="/etc/udp_pro_active"

# ==================================================
#            FONCTIONS DE BASE (BASH)
# ==================================================

add_user() {
    title "CREATE USER UDP"
    print_center -ama "Create User UDP Custom"
    msg -bar
    msg -ne " Username: " && read user
    if getent passwd $user > /dev/null 2>&1; then
        print_center -verm "User $user already exists"
        enter
        return
    fi
    msg -ne " Password: " && read pass
    msg -ne " Days Duration: " && read days
    
    exp_date=$(date -d "+$days days" +%Y-%m-%d)
    
    useradd -M -s /bin/false -e $exp_date $user
    echo "$user:$pass" | chpasswd
    
    clear
    msg -bar
    print_center -verd "User Created Successfully"
    msg -bar
    msg -ama " ğŸ‘¤ Username  : $user"
    msg -ama " ğŸ”‘ Password  : $pass"
    msg -ama " ğŸ›¡ï¸ Port UDP  : 1-65535"
    msg -ama " ğŸ“… Expiry    : $exp_date"
    msg -bar
    enter
}

renew_user() {
    title "RENEW USER UDP"
    print_center -ama "Renew User UDP Custom"
    msg -bar
    msg -ne " Username: " && read user
    if ! getent passwd $user > /dev/null 2>&1; then
        print_center -verm "User $user not found"
        enter
        return
    fi
    msg -ne " Days to add: " && read days
    chage -E $(date -d "+$days days" +%Y-%m-%d) $user
    
    new_exp=$(chage -l $user | grep 'Account expires' | cut -d: -f2)
    
    clear
    msg -bar
    print_center -verd "User Renewed Successfully"
    msg -bar
    msg -ama " ğŸ‘¤ Username  : $user"
    msg -ama " ğŸ“… New Expiry: $new_exp"
    msg -bar
    enter
}

remove_user() {
    title "REMOVE USER UDP"
    print_center -ama "Remove User UDP Custom"
    msg -bar
    msg -ne " Username: " && read user
    if ! getent passwd $user > /dev/null 2>&1; then
        print_center -verm "User $user not found"
        enter
        return
    fi
    userdel -f $user
    msg -bar
    print_center -verd "User $user Removed Successfully"
    msg -bar
    enter
}

list_users() {
    title "LIST USERS UDP"
    print_center -ama "List of Users"
    msg -bar
    echo -e " \033[1;33mUSERNAME \033[1;37m| \033[1;32mEXPIRATION"
    msg -bar
    while read line; do
        u=$(echo $line | cut -d: -f1)
        exp=$(chage -l $u | grep "Account expires" | cut -d: -f2)
        echo -e " \033[1;37m$u \033[1;33m-> \033[1;32m$exp"
    done < <(grep "/bin/false" /etc/passwd)
    enter
}

# ==================================================
#            FONCTIONS PRO+ (BOT V4 - FINAL)
# ==================================================

install_bot_pro() {
  title "ğŸ¤– INSTALLATION BOT TELEGRAM PRO V4"
  msg -azu " Installation du Panel de Gestion Complet."
  msg -bar
  msg -ne " Token Bot (BotFather): " && read token
  msg -ne " ID Admin Telegram: " && read admin_id
  
  vps_ip=$(curl -s ipv4.icanhazip.com)

  msg -verd " Installation des dÃ©pendances Python..."
  apt-get install python3-pip at sqlite3 -y > /dev/null 2>&1
  pip3 install pyTelegramBotAPI > /dev/null 2>&1

  # --- CRÃ‰ATION DU SCRIPT PYTHON (CERVEAU DU BOT) ---
  cat << 'PYTHON_MARKER' > /etc/UDPCustom/udp_bot.py
import telebot
from telebot import types
import os
import subprocess
import random
import string
import datetime
import time
import re
import sqlite3

# --- CONFIGURATION ---
TOKEN = "TOKEN_PLACEHOLDER"
ADMIN_ID = "ADMIN_ID_PLACEHOLDER"
VPS_IP = "IP_PLACEHOLDER"
DB_PATH = "/etc/UDPCustom/bot_users.db"
# ---------------------

bot = telebot.TeleBot(TOKEN)

# --- BASE DE DONNÃ‰ES (Pour stocker les mots de passe) ---
def init_db():
    conn = sqlite3.connect(DB_PATH, check_same_thread=False)
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS users (username TEXT PRIMARY KEY, password TEXT)''')
    conn.commit()
    conn.close()

def save_user_db(user, password):
    try:
        conn = sqlite3.connect(DB_PATH, check_same_thread=False)
        c = conn.cursor()
        c.execute("INSERT OR REPLACE INTO users (username, password) VALUES (?, ?)", (user, password))
        conn.commit()
        conn.close()
    except:
        pass

def get_pass_db(user):
    try:
        conn = sqlite3.connect(DB_PATH, check_same_thread=False)
        c = conn.cursor()
        c.execute("SELECT password FROM users WHERE username=?", (user,))
        res = c.fetchone()
        conn.close()
        if res:
            return res[0]
        else:
            return "Inconnu (CrÃ©Ã© manuellement)"
    except:
        return "Erreur DB"

def del_user_db(user):
    try:
        conn = sqlite3.connect(DB_PATH, check_same_thread=False)
        c = conn.cursor()
        c.execute("DELETE FROM users WHERE username=?", (user,))
        conn.commit()
        conn.close()
    except:
        pass

# --- OUTILS ---
def run_cmd(cmd):
    return subprocess.getoutput(cmd)

def generate_pass(length=6):
    return ''.join(random.choices(string.ascii_lowercase + string.digits, k=length))

def get_users_list():
    cmd = "awk -F: '/\/bin\/false/ {print $1}' /etc/passwd"
    users = run_cmd(cmd).split('\n')
    return [u for u in users if u]

def get_expiry(user):
    try:
        cmd = f"chage -l {user} | grep 'Account expires' | cut -d: -f2"
        return run_cmd(cmd).strip()
    except:
        return "Erreur"

def parse_duration(text):
    match = re.match(r"(\d+)([mhd])", text.lower())
    if not match: return None
    val, unit = int(match.group(1)), match.group(2)
    return val, unit

# --- MENU PRINCIPAL ---
def main_menu():
    markup = types.InlineKeyboardMarkup(row_width=2)
    b1 = types.InlineKeyboardButton("ğŸ‘¤ CrÃ©er User", callback_data='add_wiz')
    b2 = types.InlineKeyboardButton("ğŸ‘¥ Liste Users", callback_data='list_menu')
    b3 = types.InlineKeyboardButton("ğŸ”„ Renouveler", callback_data='renew_menu')
    b4 = types.InlineKeyboardButton("âœï¸ Modifier", callback_data='edit_menu')
    b5 = types.InlineKeyboardButton("ğŸ—‘ Supprimer", callback_data='del_menu')
    b6 = types.InlineKeyboardButton("â± Trial (Test)", callback_data='trial_menu')
    b7 = types.InlineKeyboardButton("ğŸ–¥ Infos VPS", callback_data='info')
    b8 = types.InlineKeyboardButton("ğŸ“ Contact", url="https://t.me/joeldata237")
    markup.add(b1, b2, b3, b4, b5, b6, b7, b8)
    return markup

@bot.message_handler(commands=['start', 'menu'])
def send_welcome(message):
    if str(message.chat.id) == str(ADMIN_ID):
        bot.reply_to(message, "ğŸ”° **JOEL DATA - UDP MANAGER PRO** ğŸ”°\n\nBienvenue MaÃ®tre. GÃ©rez vos clients ci-dessous :", reply_markup=main_menu(), parse_mode="Markdown")

# --- GESTION DES CLICS ---
@bot.callback_query_handler(func=lambda call: True)
def callback_query(call):
    if str(call.message.chat.id) != str(ADMIN_ID): return

    # RETOUR ACCUEIL
    if call.data == "home":
        bot.edit_message_text("ğŸ”° **MENU PRINCIPAL** ğŸ”°", call.message.chat.id, call.message.message_id, reply_markup=main_menu(), parse_mode="Markdown")

    # ================= LISTE USERS (BOUTONS) =================
    elif call.data == "list_menu":
        users = get_users_list()
        markup = types.InlineKeyboardMarkup(row_width=2)
        if not users:
            markup.add(types.InlineKeyboardButton("Aucun utilisateur", callback_data="home"))
        else:
            for u in users:
                markup.add(types.InlineKeyboardButton(f"ğŸ‘¤ {u}", callback_data=f"view_user:{u}"))
        markup.add(types.InlineKeyboardButton("ğŸ”™ Retour", callback_data="home"))
        bot.edit_message_text("ğŸ“‚ **SÃ©lectionnez un utilisateur pour voir les dÃ©tails :**", call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode="Markdown")

    # DÃ‰TAILS USER (Avec Password visible !)
    elif call.data.startswith("view_user:"):
        user = call.data.split(":")[1]
        exp = get_expiry(user)
        real_pass = get_pass_db(user) # RÃ©cupÃ¨re le pass depuis la DB
        
        format_client = f"{VPS_IP}:1-65535@{user}:{real_pass}"
        
        decor = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ **DÃ‰TAILS COMPTE**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ **User :** `{user}`
ğŸ”‘ **Pass :** `{real_pass}`
ğŸ“… **Expire :** `{exp}`
ğŸ›¡ **Port :** `1-65535`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘‡ **Format Client :**
`{format_client}`
"""
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("ğŸ”™ Retour Liste", callback_data="list_menu"),
                   types.InlineKeyboardButton("ğŸ  Accueil", callback_data="home"))
        bot.edit_message_text(decor, call.message.chat.id, call.message.message_id, parse_mode="Markdown", reply_markup=markup)


    # ================= SUPPRIMER (BOUTONS) =================
    elif call.data == "del_menu":
        users = get_users_list()
        markup = types.InlineKeyboardMarkup(row_width=2)
        if not users:
            markup.add(types.InlineKeyboardButton("Vide", callback_data="home"))
        else:
            for u in users:
                markup.add(types.InlineKeyboardButton(f"âŒ {u}", callback_data=f"pre_del:{u}"))
        markup.add(types.InlineKeyboardButton("ğŸ”™ Retour", callback_data="home"))
        bot.edit_message_text("ğŸ—‘ **SÃ©lectionnez un utilisateur Ã  SUPPRIMER :**", call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode="Markdown")

    elif call.data.startswith("pre_del:"):
        user = call.data.split(":")[1]
        exp = get_expiry(user)
        decor = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ **CONFIRMATION**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ **User :** `{user}`
ğŸ“… **Expire :** `{exp}`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Supprimer ce compte ?
"""
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("âœ… OUI", callback_data=f"do_del:{user}"))
        markup.add(types.InlineKeyboardButton("ğŸ”™ NON", callback_data="del_menu"))
        bot.edit_message_text(decor, call.message.chat.id, call.message.message_id, parse_mode="Markdown", reply_markup=markup)

    elif call.data.startswith("do_del:"):
        user = call.data.split(":")[1]
        os.system(f"userdel -f {user}")
        del_user_db(user) # Supprime aussi de la DB
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("ğŸ”™ Retour Menu", callback_data="home"))
        bot.edit_message_text(f"âœ… Compte `{user}` supprimÃ©.", call.message.chat.id, call.message.message_id, parse_mode="Markdown", reply_markup=markup)


    # ================= RENOUVELER (BOUTONS) =================
    elif call.data == "renew_menu":
        users = get_users_list()
        markup = types.InlineKeyboardMarkup(row_width=2)
        for u in users:
            markup.add(types.InlineKeyboardButton(f"ğŸ”„ {u}", callback_data=f"renew_wiz:{u}"))
        markup.add(types.InlineKeyboardButton("ğŸ”™ Retour", callback_data="home"))
        bot.edit_message_text("ğŸ”„ **SÃ©lectionnez un utilisateur Ã  RENOUVELER :**", call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode="Markdown")

    elif call.data.startswith("renew_wiz:"):
        user = call.data.split(":")[1]
        msg = bot.send_message(call.message.chat.id, f"ğŸ‘¤ **User:** `{user}`\n\nEntrez la durÃ©e Ã  ajouter (ex: `10m`, `10h`, `10d`) :", parse_mode="Markdown")
        bot.register_next_step_handler(msg, step_renew_process, user)


    # ================= MODIFIER (BOUTONS) =================
    elif call.data == "edit_menu":
        users = get_users_list()
        markup = types.InlineKeyboardMarkup(row_width=2)
        for u in users:
            markup.add(types.InlineKeyboardButton(f"âœï¸ {u}", callback_data=f"edit_start:{u}"))
        markup.add(types.InlineKeyboardButton("ğŸ”™ Retour", callback_data="home"))
        bot.edit_message_text("âœï¸ **SÃ©lectionnez un utilisateur Ã  MODIFIER :**", call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode="Markdown")
    
    elif call.data.startswith("edit_start:"):
        user = call.data.split(":")[1]
        msg = bot.send_message(call.message.chat.id, f"ğŸ“ Modification de `{user}`\n\nEntrez le **NOUVEAU NOM** (ou 'meme') :", parse_mode="Markdown")
        bot.register_next_step_handler(msg, step_edit_name, user)


    # ================= TRIAL & ADD =================
    elif call.data == "trial_menu":
        markup = types.InlineKeyboardMarkup()
        markup.add(types.InlineKeyboardButton("â± 30 Min", callback_data="trial:30"),
                   types.InlineKeyboardButton("â± 1 Heure", callback_data="trial:60"))
        markup.add(types.InlineKeyboardButton("ğŸ”™ Retour", callback_data="home"))
        bot.edit_message_text("â³ Choisissez la durÃ©e du test :", call.message.chat.id, call.message.message_id, reply_markup=markup)

    elif call.data.startswith("trial:"):
        mins = int(call.data.split(":")[1])
        user = "test" + ''.join(random.choices(string.digits, k=4))
        pwd = generate_pass(4)
        
        os.system(f"useradd -M -s /bin/false {user}")
        os.system(f"echo '{user}:{pwd}' | chpasswd")
        os.system(f"echo 'userdel -f {user}' | at now + {mins} minutes")
        save_user_db(user, pwd) # Sauvegarde DB
        
        format_client = f"{VPS_IP}:1-65535@{user}:{pwd}"
        
        decor = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… **COMPTE TEST ACTIVÃ‰**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ **User :** `{user}`
ğŸ”‘ **Pass :** `{pwd}`
â³ **DurÃ©e :** {mins} Minutes
ğŸ›¡ **Port :** `1-65535`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘‡ **Format Client :**
`{format_client}`
"""
        bot.send_message(call.message.chat.id, decor, parse_mode="Markdown")
        bot.send_message(call.message.chat.id, "Menu Principal :", reply_markup=main_menu())

    elif call.data == "add_wiz":
        msg = bot.send_message(call.message.chat.id, "ğŸ‘¤ Entrez le **Nom d'utilisateur** :", parse_mode="Markdown")
        bot.register_next_step_handler(msg, step_name)

    elif call.data == "info":
        ram = run_cmd("free -m | awk 'NR==2{printf \"%.2f%%\", $3*100/$2 }'")
        bot.answer_callback_query(call.id, f"IP: {VPS_IP} | RAM: {ram}", show_alert=True)

# --- STEPS AJOUT USER ---
def step_name(message):
    user = message.text
    msg = bot.send_message(message.chat.id, f"User: `{user}`\nğŸ”‘ Entrez le **Mot de Passe** :", parse_mode="Markdown")
    bot.register_next_step_handler(msg, step_pass, user)

def step_pass(message, user):
    pwd = message.text
    msg = bot.send_message(message.chat.id, f"Pass: `{pwd}`\nğŸ“… Entrez la **DurÃ©e (Jours)** :", parse_mode="Markdown")
    bot.register_next_step_handler(msg, step_days, user, pwd)

def step_days(message, user, pwd):
    try:
        days = int(message.text)
        os.system(f"useradd -M -s /bin/false -e $(date -d '+{days} days' +%Y-%m-%d) {user}")
        os.system(f"echo '{user}:{pwd}' | chpasswd")
        save_user_db(user, pwd) # Sauvegarde DB
        
        format_client = f"{VPS_IP}:1-65535@{user}:{pwd}"

        decor = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… **COMPTE CRÃ‰Ã‰**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ **User :** `{user}`
ğŸ”‘ **Pass :** `{pwd}`
ğŸ“… **Jours :** {days}
ğŸ›¡ **Port :** `1-65535`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘‡ **Format Client :**
`{format_client}`
"""
        bot.send_message(message.chat.id, decor, parse_mode="Markdown", reply_markup=main_menu())
    except:
        bot.send_message(message.chat.id, "âŒ Erreur durÃ©e.")

# --- STEPS RENOUVELLEMENT ---
def step_renew_process(message, user):
    txt = message.text 
    res = parse_duration(txt)
    
    if not res:
        bot.send_message(message.chat.id, "âŒ Format invalide. Utilisez `m`, `h`, `d`. Ex: `30d`", parse_mode="Markdown")
        return

    val, unit = res
    msg_fin = ""
    
    if unit == 'd':
        os.system(f"chage -E $(date -d '+{val} days' +%Y-%m-%d) {user}")
        msg_fin = f"ProlongÃ© de {val} Jours."
    elif unit == 'h':
         os.system(f"echo 'userdel -f {user}' | at now + {val} hours")
         msg_fin = f"Expire dans {val} Heures."
    elif unit == 'm':
         os.system(f"echo 'userdel -f {user}' | at now + {val} minutes")
         msg_fin = f"Expire dans {val} Minutes."

    bot.send_message(message.chat.id, f"âœ… Compte `{user}` mis Ã  jour.\n{msg_fin}", parse_mode="Markdown", reply_markup=main_menu())

# --- STEPS MODIFICATION ---
def step_edit_name(message, old_user):
    new_user = message.text
    final_user = old_user
    if new_user.lower() != "meme":
        os.system(f"usermod -l {new_user} {old_user}")
        # Mettre Ã  jour la DB si changement de nom (supprimer ancien, garder pass pour nouveau)
        old_pass = get_pass_db(old_user)
        del_user_db(old_user)
        save_user_db(new_user, old_pass)
        final_user = new_user
    
    msg = bot.send_message(message.chat.id, f"User: `{final_user}`\nğŸ”‘ Entrez le **NOUVEAU PASS** (ou 'meme') :", parse_mode="Markdown")
    bot.register_next_step_handler(msg, step_edit_pass, final_user)

def step_edit_pass(message, user):
    new_pass = message.text
    final_pass = new_pass
    if new_pass.lower() != "meme":
        os.system(f"echo '{user}:{new_pass}' | chpasswd")
        save_user_db(user, new_pass) # Mettre Ã  jour DB
    else:
        final_pass = get_pass_db(user)
    
    msg = bot.send_message(message.chat.id, f"Pass: `{final_pass}`\nğŸ“… Entrez la **NOUVELLE DURÃ‰E** en jours (ou 'meme') :", parse_mode="Markdown")
    bot.register_next_step_handler(msg, step_edit_final, user, final_pass)

def step_edit_final(message, user, pwd):
    days = message.text
    exp_msg = ""
    if days.lower() != "meme":
        try:
             os.system(f"chage -E $(date -d '+{days} days' +%Y-%m-%d) {user}")
             exp_msg = f"{days} Jours"
        except:
             exp_msg = "Erreur date"
    else:
        exp_msg = "InchangÃ©e"
    
    format_client = f"{VPS_IP}:1-65535@{user}:{pwd}"

    decor = f"""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœï¸ **COMPTE MODIFIÃ‰**
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘¤ **User :** `{user}`
ğŸ”‘ **Pass :** `{pwd}`
ğŸ“… **DurÃ©e :** `{exp_msg}`
ğŸ›¡ **Port :** `1-65535`
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‘‡ **Nouveau Format :**
`{format_client}`
"""
    bot.send_message(message.chat.id, decor, parse_mode="Markdown", reply_markup=main_menu())

# --- LANCEMENT ---
if __name__ == '__main__':
    init_db() # Initialisation DB
    print("Bot DÃ©marrÃ©...")
    bot.polling(non_stop=True)
PYTHON_MARKER

  # Injection des variables BASH dans le fichier PYTHON
  sed -i "s/TOKEN_PLACEHOLDER/$token/g" /etc/UDPCustom/udp_bot.py
  sed -i "s/ADMIN_ID_PLACEHOLDER/$admin_id/g" /etc/UDPCustom/udp_bot.py
  sed -i "s/IP_PLACEHOLDER/$vps_ip/g" /etc/UDPCustom/udp_bot.py

  # CrÃ©ation du service Bot
  cat << 'SERVICE_MARKER' > /etc/systemd/system/udp-bot.service
[Unit]
Description=UDP Bot Pro V4
After=network.target
[Service]
User=root
WorkingDirectory=/etc/UDPCustom
ExecStart=/usr/bin/python3 /etc/UDPCustom/udp_bot.py
Restart=always
[Install]
WantedBy=multi-user.target
SERVICE_MARKER

  systemctl daemon-reload
  systemctl enable udp-bot
  systemctl restart udp-bot
  
  msg -verd " âœ… Bot V4 (Panel Complet + Passwords) InstallÃ© !"
  enter
}

# 4. ONLINE USERS (Fonction Bash Menu)
online_pro() {
  title "ğŸŸ¢ UTILISATEURS EN LIGNE"
  count=$(netstat -nulp | grep udp-custom | wc -l)
  msg -bar
  print_center -verd "Active Users Count"
  msg -bar
  echo -e "       \033[1;37mTotal: \033[1;32m$count"
  msg -bar
  enter
}

# 5. SYSTÃˆME DE LICENCE (CORRIGÃ‰ POUR API LOCALE)
check_license() {
    if [[ -f "$LICENSE_FILE" ]]; then
        return 0
    fi
    title "ğŸ”’ UDP CUSTOM PRO+"
    msg -verm " Cette section est verrouillÃ©e."
    msg -ama " Contactez @joeldata237 pour le code."
    msg -bar
    msg -ne " Entrez le Code : " && read key
    
    # VÃ©rification rÃ©elle via l'API locale
    res=$(curl -s "$VERIFY_URL?key=$key")
    
    if [[ "$res" == "VALID" ]]; then
        msg -verd " âœ… CODE VALIDE ! Bienvenue."
        touch "$LICENSE_FILE"
        sleep 2
        return 0
    else
        msg -verm " âŒ Code Invalide (Serveur Key: $res)"
        sleep 2
        return 1
    fi
}

# ==================================================
#                  MENU PRINCIPAL
# ==================================================
udp() {
    title "JOEL DATA - UDP MANAGER V10"
    
    echo -e " \033[1;32m[1]\033[1;33m CrÃ©er Utilisateur (Manuel)"
    echo -e " \033[1;32m[2]\033[1;33m Supprimer Utilisateur"
    echo -e " \033[1;32m[3]\033[1;33m Renouveler Utilisateur"
    echo -e " \033[1;32m[4]\033[1;33m Liste des Utilisateurs"
    echo -e " \033[1;32m[5]\033[1;33m Infos VPS (Neofetch)"
    
    if [[ -f "$LICENSE_FILE" ]]; then
        msg -bar2
        print_center -verd "--- OPTIONS PRO+ ---"
        echo -e " \033[1;36m[6]\033[1;37m INSTALLER BOT TELEGRAM V4 ğŸ¤–"
        echo -e " \033[1;36m[7]\033[1;37m Voir Utilisateurs En Ligne ğŸŸ¢"
        echo -e " \033[1;31m[8]\033[1;37m Supprimer Licence"
    else
        msg -bar2
        echo -e " \033[1;31m[6]\033[1;33m UDP CUSTOM PRO+ (DÃ©bloquer) ğŸ”’"
    fi

    msg -bar
    echo -e " \033[1;31m[0]\033[1;37m Quitter"
    msg -bar
    
    read -p " SÃ©lection : " selection
    case $selection in
        1) add_user ;;
        2) remove_user ;;
        3) renew_user ;;
        4) list_users ;;
        5) neofetch; enter ;;
        6) 
            if [[ -f "$LICENSE_FILE" ]]; then install_bot_pro; else check_license && install_bot_pro; fi ;;
        7) 
            if [[ -f "$LICENSE_FILE" ]]; then online_pro; else check_license && online_pro; fi ;;
        8) 
            if [[ -f "$LICENSE_FILE" ]]; then rm "$LICENSE_FILE"; menu; fi ;;
            
        0) exit 0 ;;
        *) msg -verm "Option Invalide"; sleep 1; udp ;;
    esac
}

udp
